(function() {
	
	var Index = {
		_init : function() {
			window.Index= Index;
		},
		IndexData : {}
	};
	
	//初始化
	Index.Base = {
		Dict : {
			XB : (function() {
				return new Util.Dict();
			})()
		}
	};
	
	Index.IndexData = (function() {
		//页面加载
		function IndexDataLoad() {
			//渲染页面
			$('body').mask().setMask();
			$.when(Dao.Dictionary.getDict('XB')).done(function(xb){
				Index.Base.Dict.XB.Set(xb);
			}).then(function(){
				$('body').mask().clearMask();
				IndexDataRender();
			}).fail(function(){
				$('body').mask().clearMask();
				window.parent.Util.warn('数据获取失败！');
			});
		};
		
		//渲染列表页面
		function IndexDataRender(){
			
			var $loginName = $('input[name="loginName"]');
			var $password = $('input[name="password"]');
			
			//表单是否填写验证
			$loginName.blur(function() {
				if($loginName.val() == "") {
					Util.Tip.warning("账号不能为空！");
					return false;
				}
			});
			$password.blur(function() {
				if($password.val() == "") {
					Util.Tip.warning("密码不能为空！");
					return false;
				}
			});
			
			$('.signin input').click(function() {
				//表单是否填写验证
				if($loginName.val() == "") {
					Util.Tip.warning("账号不能为空！");
					return false;
				}
				if($password.val() == "") {
					Util.Tip.warning("密码不能为空！");
					return false;
				}
				//验证密码规则
				if($.trim($password.val()).length<6 || $.trim($password.val()).length > 20){
					Util.Tip.warning("密码长度必须是6到20位 ！");
				    $password.focus();
					return false;
				}
				
				Util.mask.set();
				//提交个人用户表单数据
				$.ajax({
					type : "POST",
					dataType:"json",
					url : CONTEXTPATH + "/user/userLogin.do",
					data : $('#loginForm').serialize(),
					success : function(data) {
						if(data.data == "LOGINNAME_ERROR") {
							Util.Tip.warning('账号不正确！');
							$loginName.focus();
							Util.mask.clear();
							return false;
						}else if(data.data == "PASSWORD_ERROR") {
							Util.Tip.warning('密码不正确！');
							$password.focus();
							Util.mask.clear();
							return false;
						}else {
							Util.Tip.success("登陆成功！");
							Util.mask.clear();
				    		window.open(CONTEXTPATH+"/home/home.do", "_self");
						}
					},
					error : function() {  
						Util.Tip.warning('登陆失败，请检查表单填写是否有误！');
				    }
				});
				//登陆的enter键支持
				enterEvent();
			});
		}
		
		return {
			IndexDataLoad : IndexDataLoad
		};
	})();
	
	Index._init();
})();