/**	
 * <br>
 * Copyright 2015 IFlyTek. All rights reserved.<br>
 * <br>			 
 * Package: com.xiongwu.lingzhong.persistence <br>
 * FileName: UserDao.java <br>
 * <br>
 * @version
 * @author xiongwu@iflytek.com
 * @created 2015年12月5日
 * @last Modified 
 * @history
 */

package com.xiongwu.lingzhong.persistence;

import java.util.List;

import com.iflytek.iframework.orm.hibernate.HibernateEntityDao;
import com.iflytek.iframework.utils.HqlMaker;
import com.xiongwu.lingzhong.domain.TZlUserPerson;
import com.xiongwu.lingzhong.domain.dto.LoginUserDto;
import com.xiongwu.utils.DateUtils;

/**
 *  注册用户Dao
 *  
 *  @author xiongwu@iflytek.com
 *  @created 2015年12月5日 下午4:50:46
 *  @lastModified       
 *  @history           
 */

public class UserDao extends HibernateEntityDao<TZlUserPerson>{
	
	/**
	 * 	验证唯一性
	 *  
	 *  @param classname 表名
	 *  @param fieldName
	 *  @param fieldValue
	 *  @return
	 *  @author xiongwu@iflytek.com
	 *  @created 2015年12月9日 下午1:37:26
	 *  @lastModified       
	 *  @history
	 */
	public boolean verifyUserInfo(String classname, String fieldName, String fieldValue) {
		StringBuilder hql = new StringBuilder("select count(*) from ").append(classname).append(" where 1=1 ");
        hql.append(HqlMaker.popuHqlEq(fieldName, fieldValue));
        if(Integer.parseInt(this.createQuery(hql.toString()).uniqueResult().toString()) > 0){
        	return false;
        }
		return true;
	}
	
	/**
	 * 	登陆
	 *  
	 *  @param loginUser 登陆用户
	 *  @return
	 *  @author xiongwu@iflytek.com
	 *  @created 2015年12月23日 下午1:29:35
	 *  @lastModified       
	 *  @history
	 */
	public TZlUserPerson queryUniqueLoginUser(LoginUserDto loginUser) {
		StringBuilder hql = new StringBuilder(" from TZlUserPerson where ");
		hql.append("loginName=? or email=? or mobilePhone=?");

        @SuppressWarnings("unchecked")
		List<TZlUserPerson> list = this.createQuery(hql.toString(),loginUser.getLoginName(),
				loginUser.getEmail(),loginUser.getMobilePhone()).list();
        if(list.size()>0){
        	return list.get(0);
        }else{
        	return null;
        }
	}
	
	/**
	 * 	用户修改密码
	 *  
	 *  @param email 邮箱
	 *  @param newPassword 新密码
	 *  @return
	 *  @author xiongwu@iflytek.com
	 *  @created 2015年12月23日 下午1:38:02
	 *  @lastModified       
	 *  @history
	 */
	public int updatePwd(String email, String newPassword) {
		
		StringBuffer queryHql=new StringBuffer(" ");
		queryHql.append(" update TZlUserPerson set password=:password, updateTime=:updateTime where email=:email ");
		int num = createQuery(queryHql.toString()).setParameter("password", newPassword).setParameter("updateTime", DateUtils.getCurrentGaDate()).setParameter("email", email).executeUpdate();
		return num;
	}

}




