(function() {
	var Register = {
		_init : function() {
			window.Register= Register;
		},
		List : {}
	};
	
	//初始化
	Register.Base = {
		Dict : {
			XB : (function() {
				return new Util.Dict();
			})()
		}
	};
	
	
	Register.List = (function() {
		
		//页面加载
		function pageUserListLoad() {
			
			//渲染页面
			$('body').mask().setMask();
			$.when(Dao.Dictionary.getDict('XB')).done(function(xb){
				Register.Base.Dict.XB.Set(xb);
			}).then(function(){
				$('body').mask().clearMask();
				UserRegisterRender();
			}).fail(function(){
				$('body').mask().clearMask();
				window.parent.Util.warn('数据获取失败！');
			});
		};
		
		//渲染列表页面
		function UserRegisterRender(){
			
			
			
			$('#gender').comboBox({
                data : Register.Base.Dict.XB.GetData(),
                multiple : false,
                emptyText: '全部'
            });
		};
		
        // 获取选中的主键集合
		function getIds(tip) {
			var ids = [];
			var states = [];
			$(".id-check:checked").each(function(n, e) {
				ids.push($(e).val());
				states.push($(e).parent().siblings(".op-state").attr("title"));
			});
			if (ids.length == 0) {
				window.Util.warn(tip);
			}
			return [ids, states];
		}
		return {
			pageUserListLoad : pageUserListLoad
		};
	})();
	
	//基本工具
	/*Register.Utils=(function(){
		
		//格式化日期
		function formatterDate(time){
			if(time.length==14){
				return time.substring(0,4)+"-"+time.substring(4,6)+"-"+time.substring(6,8)+" "+time.substring(8,10)+":"+time.substring(10,12)+":"+time.substring(12,14);
			}
			return "&nbsp;";
		}
		
		//格式化名字
		function formatterName(id,name){
			return '<a style="cursor:pointer" onclick="User.Utils.showImage(\''+id+'\')">'+name+'</a>';
		}
		
		//显示用户图片
		function showImage(id){
			$.artDialog({
				title:"图片",
				content:'<img src="'+CONTEXTPATH+'/user/userimage.do?id='+id+'&romdom='+Math.random()+'" style="max-height:350px;max-width:350px" onError="User.Utils.defaultImage(this)" />',
				lock:true,
				width:400,
				height:400,
				padding:'20px',
				esc:true,
				fixed:true,
				okVal : "关闭",
				ok:function(){}
			});
		}
		
		//默认图片展示
		function defaultImage(obj){
			obj.src=CONTEXTPATH+"/resources/img/temp-image.jpg";
		}
		
		return {
			showImage : showImage,
			defaultImage : defaultImage,
			formatterDate : formatterDate,
			formatterName : formatterName
		};
	})();*/
	Register._init();
	
})();



//隐藏第二步、第三步
$(function() {
	$(".basic_info").hide();
	$(".information").hide();
});
/*
//表单是否填写验证
$('input[name="loginName"]').blur(function() {
	if($('input[name="loginName"]').val() == "") {
		Util.Tip.warning("登陆名不能为空！");
		return false;
	}
});

$('input[name="password"]').blur(function() {
	if($('input[name="password"]').val() == "") {
		Util.Tip.warning("密码不能为空！");
		return false;
	}
});

$('input[name="cpassword"]').blur(function() {
	if($('input[name="cpassword"]').val() == "") {
		Util.Tip.warning("重复密码不能为空！");
		return false;
	}
});

//验证密码强度
$('input[name="password"]').passStrengthify({
	element:  $('.pwd-strength-show'),
    levels: ['很弱', '弱', '中', '强'],//['Very weak', 'Very weak', 'Weak', 'Weak', 'Moderate', 'Good', 'Strong', 'Very strong']
    colours:['gray', '#C00000','orange', 'green'],// ['gray', 'red', 'red', '#C00000', 'orange', '#0099FF', 'blue', 'green']
    tests: [16, 48, 72],//[0, 8, 16, 32, 48, 64, 72]
    labels: { // text for labels
      passwordStrength : '',
      tooShort: '很弱'
    }
});

//判断2次密码是否一致
$("input[name='cpassword']").blur(function(){
	if ($.trim($("input[name='password']").val()) != $.trim($("input[name='cpassword']").val())) {
		Util.Tip.warning("两次输入密码不匹配！");
		return false;
	}
});

$('input[name="nickName"]').blur(function() {
	if($('input[name="nickName"]').val() == "") {
		Util.Tip.warning("昵称不能为空！");
		return false;
	}
});

$('input[name="realName"]').blur(function() {
	if($('input[name="realName"]').val() == "") {
		Util.Tip.warning("真实姓名不能为空！");
		return false;
	}
});

$('input[name="szdProvince"]').blur(function() {
	if($('input[name="szdProvince"]').val() == "") {
		Util.Tip.warning("所在地-省不能为空！");
		return false;
	}
});

$('input[name="szdCity"]').blur(function() {
	if($('input[name="szdCity"]').val() == "") {
		Util.Tip.warning("所在地-市不能为空！");
		return false;
	}
});

$('input[name="gender"]').blur(function() {
	if($('input[name="gender"]').val() == "") {
		Util.Tip.warning("性别不能为空！");
		return false;
	}
});

$('input[name="email"]').blur(function() {
	if($('input[name="email"]').val() == "") {
		Util.Tip.warning("邮箱不能为空！");
		return false;
	}
});

$('input[name="mobilePhone"]').blur(function() {
	if($('input[name="mobilePhone"]').val() == "") {
		Util.Tip.warning("手机号不能为空！");
		return false;
	}
});

$('input[name="qq"]').blur(function() {
	if($('input[name="qq"]').val() == "") {
		Util.Tip.warning("QQ不能为空！");
		return false;
	}
});

//jQuery time
var current_fs, next_fs, previous_fs; //fieldsets
var left, opacity, scale; //fieldset properties which we will animate
var animating; //flag to prevent quick multi-click glitches

$(".next").click(function(){
	//	验证登录名规则
	var $loginName = $('input[name="loginName"]');
	var $password = $('input[name="password"]');
	var $cpassword = $('input[name="cpassword"]');
	
	//表单验证
	if ($loginName.val() == "" || $password.val() == "" || $cpassword.val() == "") {
		Util.Tip.warning("请检查表单是否填写完整！");
		return false;
	}
	//数字和字母正则
	var loginNameReg = /^([a-zA-Z])[0-9a-zA-Z\-_\u4e00-\u9fa5]{3,19}$/;
	if($loginName && !loginNameReg.test($loginName.val())){
		Util.Tip.warning('登录帐号格式不正确！');
		$loginName.focus();
		return false;
	}
	//验证密码规则
	if($.trim($password.val()).length<6 || $.trim($password.val()).length > 20){
		Util.Tip.warning("密码长度必须是6到20位 ！");
	    $password.focus();
		return false;
	}
	//验证重复密码是否一致
	if($cpassword.val() != $password.val()) {
		Util.Tip.warning("重复密码不一致，请重新输入！");
		$cpassword.focus();
		return false;
	}
	
	if(animating) return false;
	animating = true;
	
	current_fs = $(this).parent();
	next_fs = $(this).parent().next();
	
	//activate next step on progressbar using the index of next_fs
	$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
	
	//show the next fieldset
	next_fs.show(); 
	//hide the current fieldset with style
	current_fs.animate({opacity: 0}, {
		step: function(now, mx) {
			//as the opacity of current_fs reduces to 0 - stored in "now"
			//1. scale current_fs down to 80%
			scale = 1 - (1 - now) * 0.2;
			//2. bring next_fs from the right(50%)
			left = (now * 50)+"%";
			//3. increase opacity of next_fs to 1 as it moves in
			opacity = 1 - now;
			current_fs.css({'transform': 'scale('+scale+')'});
			next_fs.css({'left': left, 'opacity': opacity});
		}, 
		duration: 800, 
		complete: function(){
			current_fs.hide();
			animating = false;
		}, 
		//this comes from the custom easing plugin
		easing: 'easeInOutBack'
	});
});

$(".second_next").click(function(){
	
	var $nickName = $('input[name="nickName"]');
	var $realName = $('input[name="realName"]');
	var $szdProvince = $('input[name="szdProvince"]');
	var $szdCity = $('input[name="szdCity"]');
	var $gender = $('input[name="gender"]');
	
	//表单验证
	if ($nickName.val() == "" || $realName.val() == "" || $szdProvince.val() == "" || $szdCity.val() == "" || $gender.val() == "") {
		Util.Tip.warning("请检查表单是否填写完整！");
		return false;
	}
	
	if(animating) return false;
	animating = true;
	
	current_fs = $(this).parent();
	next_fs = $(this).parent().next();
	
	//activate next step on progressbar using the index of next_fs
	$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
	
	//show the next fieldset
	next_fs.show(); 
	//hide the current fieldset with style
	current_fs.animate({opacity: 0}, {
		step: function(now, mx) {
			//as the opacity of current_fs reduces to 0 - stored in "now"
			//1. scale current_fs down to 80%
			scale = 1 - (1 - now) * 0.2;
			//2. bring next_fs from the right(50%)
			left = (now * 50)+"%";
			//3. increase opacity of next_fs to 1 as it moves in
			opacity = 1 - now;
			current_fs.css({'transform': 'scale('+scale+')'});
			next_fs.css({'left': left, 'opacity': opacity});
		}, 
		duration: 800, 
		complete: function(){
			current_fs.hide();
			animating = false;
		}, 
		//this comes from the custom easing plugin
		easing: 'easeInOutBack'
	});
});

$(".previous").click(function(){
	if(animating) return false;
	animating = true;
	
	current_fs = $(this).parent();
	previous_fs = $(this).parent().prev();
	
	//de-activate current step on progressbar
	$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
	
	//show the previous fieldset
	previous_fs.show(); 
	//hide the current fieldset with style
	current_fs.animate({opacity: 0}, {
		step: function(now, mx) {
			//as the opacity of current_fs reduces to 0 - stored in "now"
			//1. scale previous_fs from 80% to 100%
			scale = 0.8 + (1 - now) * 0.2;
			//2. take current_fs to the right(50%) - from 0%
			left = ((1-now) * 50)+"%";
			//3. increase opacity of previous_fs to 1 as it moves in
			opacity = 1 - now;
			current_fs.css({'left': left});
			previous_fs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
		}, 
		duration: 800, 
		complete: function(){
			current_fs.hide();
			animating = false;
		}, 
		//this comes from the custom easing plugin
		easing: 'easeInOutBack'
	});
});

$(".submit").click(function(){
	
	var $email = $('input[name="email"]');
	var $mobilePhone = $('input[name="mobilePhone"]');
	var $qq = $('input[name="qq"]');
	
	if ($email.val() == "" || $mobilePhone.val() == "" || $qq.val() == "") {
		Util.Tip.warning("请检查表单是否填写完整！");
		return false;
	}

	//邮箱验证
	emailReg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	if($email && !emailReg.test($email.val())){
		Util.Tip.warning('邮箱格式不正确！');
		$email.focus();
		return false;
	}
	
	//手机号码格式验证
	phoneReg = /^\d{11}$/;
	if($mobilePhone && !phoneReg.test($mobilePhone.val())){
		Util.Tip.warning('手机号码格式不正确！');
		$mobilePhone.focus();
		return false;
	}
	Util.mask.set();
	//提交个人用户表单数据
	$.ajax({
		type : "POST",
		url : CONTEXTPATH + "/user/registerSave.do",
		contentType: "application/x-www-form-urlencoded; charset=utf-8", 
		data : $('#userForm').serialize(),
		success : function(data) {
			Util.Tip.success("注册成功，请尽快到个人中心完善个人信息");
			//屏蔽浏览器提示，直接关闭窗口
			window.open(CONTEXTPATH+"/index.do", "_self");   
			$.dialog({
    			title:'提示',
    			icon:'succeed',
    			content:'注册成功，请到个人中心完善个人信息。',
    			drag:false,
    			lock:true,
    			close:function(){
    				Util.mask.clear();
    				//屏蔽浏览器提示，直接关闭窗口
    				window.open(CONTEXTPATH+"/index.do", "_self");     
    			}
    		});
		}
	});
})*/